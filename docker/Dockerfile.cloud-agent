FROM alpine:3.18
WORKDIR /home/weave
RUN apk add --no-cache bash conntrack-tools iproute2 util-linux curl=8.1.2-r0 libssl3=3.1.1-r1 libcrypto3=3.1.1-r1
COPY ./scope /home/weave/
ENTRYPOINT ["/home/weave/scope", "--mode=probe", "--no-app", "--probe.docker=true"]

ARG revision
LABEL works.weave.role="system" \
      maintainer="Weaveworks <help@weave.works>" \
      org.opencontainers.image.title="cloud-agent" \
      org.opencontainers.image.source="https://github.com/weaveworks/scope" \
      org.opencontainers.image.revision="${revision}" \
      org.opencontainers.image.vendor="Weaveworks"
